#
# Huawei Management Switch Configuration - Phase 1 MVP
# Generated by: {{ template_name | default('management_switch.j2') }}
# Generated at: {{ generation_time | default('2025-09-01 12:00:00') }}
# Device: {{ hostname | default('MGMT-SW-01') }}
# Role: Management Switch - Out-of-Band Management
#
<HUAWEI>
system-view

# System Identification
sysname {{ hostname | default('MGMT-SW-01') }}

# Management VLAN Configuration
vlan batch {{ mgmt_vlan | default(10) }}

# VLAN {{ mgmt_vlan | default(10) }} - Management Network
vlan {{ mgmt_vlan | default(10) }}
 description "Network Management VLAN"
 quit

# Management Interface
interface Vlanif{{ mgmt_vlan | default(10) }}
 description "Management Interface"
 ip address {{ management_ip | default('192.168.10.10') }} {{ subnet_mask | default('255.255.255.0') }}
 quit

# SSH Configuration for Remote Management
ssh server enable
ssh server-source all-interface
ssh server timeout 300
ssh server authentication-retries 3

# User Configuration
aaa
 local-user admin password irreversible-cipher $1c$q)5K&<l8$JsJkT5wR9qJ5l7M0Q2nR3p$
 local-user admin privilege level 15
 local-user admin service-type ssh
 quit

# SSH Authentication
ssh user admin authentication-type password
ssh user admin service-type all

# SNMP Configuration for Monitoring
snmp-agent
snmp-agent local-engineid 800007DB03000000000000
snmp-agent community read {{ 'public_ro' if features is defined and 'snmp_monitoring' in features else 'public' }}
snmp-agent sys-info version all

# Basic Port Configuration
{% for port_range, config in port_config.items() if port_config is defined %}
# Port Range: {{ port_range }} - {{ config.description | default('Unassigned Ports') }}
{% if '-' in port_range %}
{% set start_port, end_port = port_range.split('-') %}
interface range GigabitEthernet 0/0/{{ start_port }} to GigabitEthernet 0/0/{{ end_port }}
{% else %}
interface GigabitEthernet 0/0/{{ port_range }}
{% endif %}
 description "{{ config.description | default('Management Port') }}"
{% if config.shutdown is defined and config.shutdown %}
 shutdown
{% else %}
 undo shutdown
{% endif %}
{% if config.vlan is defined %}
 port link-type access
 port default vlan {{ config.vlan }}
{% endif %}
 quit
{% endfor %}

# Default Port Configuration if no specific config provided
{% if port_config is not defined or port_config | length == 0 %}
# Default Management Ports (1-24)
interface range GigabitEthernet 0/0/1 to GigabitEthernet 0/0/24
 description "Management Access Ports"
 port link-type access
 port default vlan {{ mgmt_vlan | default(10) }}
 undo shutdown
 quit
{% endif %}

# STP Configuration - Basic RSTP for Management
stp enable
stp mode {{ stp.mode | default('rstp') }}
stp priority {{ stp.priority | default(61440) }}

# Basic Security Features
{% if features is defined and 'ssh_management' in features %}
# Enhanced SSH Security
ssh server cipher aes128_ctr aes128_cbc
ssh server hmac sha2_256
{% endif %}

# Time and Logging
clock timezone UTC add 00:00:00
info-center enable
info-center timestamp log date

# Save Configuration
return
save

#
# Management Switch Configuration Complete
# Total VLANs: {{ [mgmt_vlan | default(10)] | length }}
# Management IP: {{ management_ip | default('192.168.10.10') }}
# Features: {{ features | join(', ') if features is defined else 'basic_switching, ssh_management' }}
#
