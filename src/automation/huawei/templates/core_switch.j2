#
# Huawei Core Switch Configuration - Phase 1 MVP
# Generated by: {{ template_name | default('core_switch.j2') }}
# Generated at: {{ generation_time | default('2025-09-01 12:00:00') }}
# Device: {{ hostname | default('CORE-SW-01') }}
# Role: Core Switch - Inter-VLAN Routing and Core Infrastructure
#
<HUAWEI>
system-view

# System Identification
sysname {{ hostname | default('CORE-SW-01') }}

# VLAN Configuration
{% if vlans is defined and vlans | length > 0 %}
vlan batch {% for vlan_id in vlans.keys() %}{{ vlan_id }}{% if not loop.last %} {% endif %}{% endfor %}

{% for vlan_id, vlan_config in vlans.items() %}
# VLAN {{ vlan_id }} - {{ vlan_config.name | default('VLAN_' + vlan_id) }}
vlan {{ vlan_id }}
 description "{{ vlan_config.description | default(vlan_config.name | default('VLAN_' + vlan_id)) }}"
 quit

{% endfor %}
{% else %}
# Default VLAN Configuration
vlan batch 10 100 101 102 103 999

vlan 10
 description "Management Network"
 quit

vlan 100
 description "Marketing Department"
 quit

vlan 101
 description "Sales Department"
 quit

vlan 102
 description "IT Department"
 quit

vlan 103
 description "Finance Department"
 quit

vlan 999
 description "Quarantine VLAN"
 quit
{% endif %}

# VLAN Interface Configuration for Inter-VLAN Routing
{% if vlans is defined and vlans | length > 0 %}
{% for vlan_id, vlan_config in vlans.items() %}
interface Vlanif{{ vlan_id }}
 description "{{ vlan_config.name | default('VLAN_' + vlan_id) }} Gateway"
 ip address {{ vlan_config.ip_address | default('192.168.' + vlan_id + '.1') }} {{ vlan_config.subnet_mask | default('255.255.255.0') }}
 undo shutdown
 quit

{% endfor %}
{% else %}
# Default VLAN Interfaces
interface Vlanif10
 description "Management Gateway"
 ip address 192.168.10.1 255.255.255.0
 undo shutdown
 quit

interface Vlanif100
 description "Marketing Gateway"
 ip address 192.168.100.1 255.255.255.0
 undo shutdown
 quit

interface Vlanif101
 description "Sales Gateway"
 ip address 192.168.101.1 255.255.255.0
 undo shutdown
 quit

interface Vlanif102
 description "IT Gateway"
 ip address 192.168.102.1 255.255.255.0
 undo shutdown
 quit

interface Vlanif103
 description "Finance Gateway"
 ip address 192.168.103.1 255.255.255.0
 undo shutdown
 quit

interface Vlanif999
 description "Quarantine Gateway"
 ip address 192.168.999.1 255.255.255.0
 undo shutdown
 quit
{% endif %}

# STP Configuration - RSTP for Core Redundancy
stp enable
stp mode {{ stp.mode | default('rstp') }}
stp priority {{ stp.priority | default(4096) }}
{% if vlans is defined %}
{% for vlan_id in vlans.keys() %}
stp instance 0 vlan {{ vlan_id }}
{% endfor %}
{% else %}
stp instance 0 vlan 10 100 101 102 103 999
{% endif %}

# Trunk Port Configuration (uplinks to other core switches and distribution)
{% if features is defined and 'trunk_links' in features %}
# Core Interconnect Trunks (typically ports 25-28)
interface range GigabitEthernet 0/0/25 to GigabitEthernet 0/0/28
 description "Core Interconnect Trunk Ports"
 port link-type trunk
 port trunk allow-pass vlan {% if vlans is defined %}{% for vlan_id in vlans.keys() %}{{ vlan_id }}{% if not loop.last %} {% endif %}{% endfor %}{% else %}10 100 101 102 103 999{% endif %}
 stp edged-port disable
 undo shutdown
 quit
{% endif %}

# Access Port Configuration for direct device connections if any
interface range GigabitEthernet 0/0/1 to GigabitEthernet 0/0/24
 description "Core Access Ports"
 port link-type access
 port default vlan {{ mgmt_vlan | default(10) }}
 undo shutdown
 quit

# OSPF Configuration for Phase 1 (Single Area)
{% if routing is defined and routing.ospf is defined %}
ospf {{ routing.ospf.process_id | default(1) }}
 router-id {{ routing.ospf.router_id | default(management_ip | default('192.168.10.1')) }}
 area {{ routing.ospf.area | default(0) }}
{% if vlans is defined %}
{% for vlan_id, vlan_config in vlans.items() %}
  network {{ vlan_config.ip_address | default('192.168.' + vlan_id + '.0') }} 0.0.0.255 
{% endfor %}
{% else %}
  network 192.168.10.0 0.0.0.255
  network 192.168.100.0 0.0.0.255
  network 192.168.101.0 0.0.0.255
  network 192.168.102.0 0.0.0.255
  network 192.168.103.0 0.0.0.255
{% endif %}
 quit
{% endif %}

# Basic Security Configuration
{% if features is defined and 'inter_vlan_routing' in features %}
# Inter-VLAN Access Control (Basic)
acl number 3000
 description "Basic Inter-VLAN Security"
 rule 10 permit ip source 192.168.10.0 0.0.0.255
 rule 20 permit ip source 192.168.100.0 0.0.0.255 destination 192.168.101.0 0.0.0.255
 rule 30 permit ip source 192.168.101.0 0.0.0.255 destination 192.168.100.0 0.0.0.255
 rule 40 deny ip source 192.168.999.0 0.0.0.255
 quit
{% endif %}

# SSH Configuration
ssh server enable
ssh server-source all-interface
ssh user admin authentication-type password
ssh user admin service-type all

# User Configuration
aaa
 local-user admin password irreversible-cipher $1c$q)5K&<l8$JsJkT5wR9qJ5l7M0Q2nR3p$
 local-user admin privilege level 15
 local-user admin service-type ssh
 quit

# SNMP Configuration
snmp-agent
snmp-agent community read public
snmp-agent sys-info version all

# System Settings
clock timezone UTC add 00:00:00
info-center enable
info-center timestamp log date

# Save Configuration
return
save

#
# Core Switch Configuration Complete
# Total VLANs: {{ vlans | length if vlans is defined else 6 }}
# Inter-VLAN Routing: Enabled
# STP Priority: {{ stp.priority | default(4096) }}
# OSPF Area: {{ routing.ospf.area | default(0) if routing is defined and routing.ospf is defined else 0 }}
# Features: {{ features | join(', ') if features is defined else 'inter_vlan_routing, stp_rstp, trunk_links' }}
#
